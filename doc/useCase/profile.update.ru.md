# Сценарий редактирования профиля пользователя веб-приложения через ChatGPT

## Общее описание сценария

### 1. Запрос на редактирование профиля

- Пользователь выражает желание отредактировать профиль через чат.
- ChatGPT собирает **идентификационный параметр**:
    - **Публичный PIN-код** пользователя, либо
    - **Адрес электронной почты пользователя**.

- Согласие пользователя на редактирование считается подразумеваемым, поэтому дополнительных подтверждений (например,
  парольной фразы) не требуется.

### 2. Генерация ссылки для редактирования профиля

- ChatGPT передаёт собранные данные (PIN или email) в сервис инициализации процесса редактирования профиля (
  `Fl64_Gpt_User_Back_Web_Api_Update_Init`).
- Сервис выполняет следующие шаги:
    1. Проверяет наличие пользователя в базе по предоставленному идентификатору (PIN или email).
    2. Если пользователь найден:
        - Генерируется уникальный токен для разового использования.
        - Создаётся ссылка, содержащая токен, для доступа к редактированию профиля.
        - На email пользователя отправляется письмо с этой ссылкой.
    3. Если пользователь не найден, процесс отклоняется, и ChatGPT уведомляет пользователя об ошибке.

### 3. Переход по ссылке и редактирование профиля

- Пользователь открывает email и переходит по ссылке для редактирования профиля.
- На веб-странице:
    1. Токен из ссылки передаётся на сервер для проверки через `Fl64_Gpt_User_Back_Web_Api_Update_Load`.
    2. Если токен валиден, загружается профиль пользователя.
    3. Пользователь может изменить следующие параметры:
        - Локаль приложения.
        - Парольную фразу.
    4. После внесения изменений пользователь подтверждает сохранение.

### 4. Сохранение изменений и завершение процесса

- Веб-приложение выполняет следующие действия:
    1. Получает изменения профиля вместе с токеном.
    2. Проверяет токен:
        - Если токен валиден, изменения сохраняются в базе данных.
        - Если токен недействителен или использован, процесс отклоняется.
    3. После успешного сохранения изменений токен удаляется из системы.

### 5. Уведомление пользователя

- Пользователь уведомляется через веб-страницу об успешном сохранении изменений.
- Если произошла ошибка, пользователю предлагается повторить процесс редактирования профиля.

---

## Точки входа

### `Fl64_Gpt_User_Back_Web_Api_Update_Init`

- **Описание:**
  Точка входа для ChatGPT для генерации ссылки на редактирование профиля.
  Сервис генерирует токен, создаёт ссылку для редактирования и отправляет её на email пользователя.

- **Параметры запроса:**
    - `pin` (целое число, необязательный): PIN-код.
    - `email` (строка, необязательный): email пользователя.

- **Результат:**
    - Если пользователь найден, на его email отправляется ссылка для редактирования профиля.
    - Если пользователь не найден, возвращается ошибка.

---

### `Fl64_Gpt_User_Back_Web_Api_Update_Load`

- **Описание:**
  Точка входа для загрузки данных профиля пользователя перед редактированием. Используется токен для проверки прав
  доступа.

- **Параметры запроса:**
    - `token` (строка, обязательный): Уникальный токен для доступа к данным профиля.

- **Результат:**
    - Если токен валиден, возвращаются данные профиля пользователя (например, локаль, настройки).
    - Если токен недействителен или использован, возвращается ошибка.

---

### `Fl64_Gpt_User_Back_Web_Api_Update_Save`

- **Описание:**
  Точка входа для сохранения изменений в профиле пользователя. Используется токен для подтверждения прав на
  редактирование.

- **Параметры запроса:**
    - `token` (строка, обязательный): Уникальный токен для редактирования профиля.
    - `locale` (строка, необязательный): Новая локаль пользователя.
    - `passphrase` (строка, необязательный): Новая парольная фраза.

- **Результат:**
    - Если токен валиден, изменения сохраняются, а токен удаляется.
    - Если токен недействителен или использован, возвращается ошибка.

---

## Основной поток сценария

1. Пользователь через чат запрашивает редактирование профиля.
2. ChatGPT передаёт идентификатор (PIN или email) в `Fl64_Gpt_User_Back_Web_Api_Update_Init`.
3. Сервис отправляет ссылку на редактирование профиля на email пользователя.
4. Пользователь переходит по ссылке, и данные профиля загружаются через `Fl64_Gpt_User_Back_Web_Api_Update_Load`.
5. Пользователь редактирует профиль через веб-страницу.
6. Веб-приложение сохраняет изменения через `Fl64_Gpt_User_Back_Web_Api_Update_Save`.

---

## Исключительные сценарии

1. **Пользователь не найден**:
    - Если пользователь с указанным PIN или email не существует, ChatGPT сообщает об этом и предлагает проверить данные.

2. **Недействительный токен**:
    - Если пользователь пытается использовать недействительный токен, веб-приложение отображает ошибку и предлагает
      запросить новую ссылку.

3. **Ошибка при сохранении изменений**:
    - Если возникает ошибка при сохранении изменений (например, проблема с базой данных), веб-приложение уведомляет
      пользователя и предлагает повторить попытку позже.

---

## Преимущества подхода

- Высокий уровень безопасности за счёт одноразовых токенов.
- Простота использования для пользователей: минимальное количество действий через чат.
- Возможность гибкой настройки профиля, включая локаль и парольную фразу.
